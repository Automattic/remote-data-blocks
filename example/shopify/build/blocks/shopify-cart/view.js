import*as t from"@wordpress/interactivity";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const o=(n={getContext:()=>t.getContext,store:()=>t.store},i={},e.d(i,n),i),r="shopifyCart";var n,i,a=function(t,e,o,r){return new(o||(o=Promise))((function(n,i){function a(t){try{l(r.next(t))}catch(t){i(t)}}function c(t){try{l(r.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(a,c)}l((r=r.apply(t,e||[])).next())}))};function c(){return a(this,arguments,void 0,(function*(t=null,e){var o;if(!t)throw new Error("No REST API URL provided");const r=yield window.fetch(t,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"},method:"POST"}),{body:n}=yield r.json();return null!==(o=null==n?void 0:n.results)&&void 0!==o?o:[]}))}function l(t,e,o){return a(this,void 0,void 0,(function*(){var r,n,i;const a=yield c(t.restUrl,{block_name:t.blockName,query_key:"RemoteDataBlocks\\Example\\Shopify\\ShopifyAddToCartMutation",query_input:{cart_id:t.cartId,variant_id:e.variantId,quantity:o}});if(!(null===(i=null===(n=null===(r=a[0])||void 0===r?void 0:r.result)||void 0===n?void 0:n.id)||void 0===i?void 0:i.value))throw new Error("Failed to add to cart: Invalid response from API");return a[0].result.id.value}))}var d,u=function(t,e,o,r){return new(o||(o=Promise))((function(n,i){function a(t){try{l(r.next(t))}catch(t){i(t)}}function c(t){try{l(r.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(a,c)}l((r=r.apply(t,e||[])).next())}))};const v={cart:{},detailsOpen:!1};try{const t=null!==(d=window.localStorage.getItem(r))&&void 0!==d?d:"{}";Object.assign(v,JSON.parse(t))}catch(t){}function s(t){const{cart:e,cartId:o,checkoutUrl:n}=t;window.localStorage.setItem(r,JSON.stringify({cart:e,cartId:o,checkoutUrl:n}))}const{state:f}=(0,o.store)("remote-data-blocks/shopify",{actions:{addToCart:()=>u(void 0,void 0,void 0,(function*(){const t=(0,o.getContext)();if(!f.cart[t.variantId]){if(!f.cartId){const{cartId:t,checkoutUrl:e}=yield function(t){return a(this,void 0,void 0,(function*(){var e,o,r,n,i,a;const l=yield c(t.restUrl,{block_name:t.blockName,query_key:"RemoteDataBlocks\\Example\\Shopify\\ShopifyCreateCartMutation",query_input:{}});if(!(null===(r=null===(o=null===(e=l[0])||void 0===e?void 0:e.result)||void 0===o?void 0:o.cart_id)||void 0===r?void 0:r.value)||!(null===(a=null===(i=null===(n=l[0])||void 0===n?void 0:n.result)||void 0===i?void 0:i.checkout_url)||void 0===a?void 0:a.value))throw new Error("Failed to create cart: Invalid response from API");return{cartId:l[0].result.cart_id.value,checkoutUrl:l[0].result.checkout_url.value}}))}(f);f.cartId=t,f.checkoutUrl=e}f.cart[t.variantId]={lineId:yield l(f,t,1),quantity:1,title:t.title},s(f)}})),removeFromCart:()=>u(void 0,void 0,void 0,(function*(){if(!f.cartId)return;const t=(0,o.getContext)();f.cart[t.variantId]&&(yield function(t,e){return a(this,void 0,void 0,(function*(){var o;const r=null===(o=t.cart[e.variantId])||void 0===o?void 0:o.lineId;if(!r)throw new Error("Failed to remove from cart: Line item not found");yield c(t.restUrl,{block_name:t.blockName,query_key:"RemoteDataBlocks\\Example\\Shopify\\ShopifyRemoveFromCartMutation",query_input:{cart_id:t.cartId,line_id:r}})}))}(f,t),Object.assign(f.cart,{[t.variantId]:void 0}),s(f))})),toggleDetails:()=>{f.detailsOpen=!f.detailsOpen}},state:{cart:v.cart,cartId:v.cartId,checkoutUrl:v.checkoutUrl,detailsOpen:v.detailsOpen,get cartArray(){return Object.values(f.cart)},get quantityInCart(){var t,e;const{variantId:r}=(0,o.getContext)();return null!==(e=null===(t=f.cart[r])||void 0===t?void 0:t.quantity)&&void 0!==e?e:0},get totalItems(){return Object.values(f.cart).reduce(((t,{quantity:e})=>t+e),0)}}});